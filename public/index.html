<script>
  let userId = localStorage.getItem("userId");

  if (!userId) {
    userId = crypto.randomUUID();
    localStorage.setItem("userId", userId);
  }

  function vote() {
    fetch("/vote", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ userId })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("result").innerText = data.message;

      const voterList = document.getElementById("voters");
      voterList.innerHTML = "";

      if (data.voters && data.voters.length > 0) {
        data.voters.forEach(v => {
          const li = document.createElement("li");
          li.innerText = v;
          voterList.appendChild(li);
        });
      }
    });
  }
</script>

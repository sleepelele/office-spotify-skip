<!DOCTYPE html>
<html>
<head>
  <title>Office Skip Vote</title>
</head>
<body style="text-align:center;font-family:sans-serif;margin-top:100px;">

  <h1>Office Skip Vote</h1>
  <h2 id="currentSong">Loading song...</h2>

  <button onclick="vote()" style="font-size:30px;padding:20px;">
    SKIP
  </button>

  <p id="result"></p>

  <h3>Voters:</h3>
  <ul id="voters"></ul>

<script>
  let userId = localStorage.getItem("userId");
  let userName = localStorage.getItem("userName");

  if (!userId) {
    userId = crypto.randomUUID();
    localStorage.setItem("userId", userId);
  }

  if (!userName) {
    userName = prompt("Enter your name (only once):");
    localStorage.setItem("userName", userName);
  }

  function loadSong() {
    fetch("/current-song")
      .then(res => res.json())
      .then(data => {
        document.getElementById("currentSong").innerText = data.title;
      });
  }

  function vote() {
    fetch("/vote", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ userId, name: userName })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("result").innerText = data.message;

      const voterList = document.getElementById("voters");
      voterList.innerHTML = "";

      if (data.voters && data.voters.length > 0) {
        data.voters.forEach(v => {
          const li = document.createElement("li");
          li.innerText = v;
          voterList.appendChild(li);
        });
      }
    });
  }

  loadSong();
  setInterval(loadSong, 10000);
</script>

</body>
</html>
